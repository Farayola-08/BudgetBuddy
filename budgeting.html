<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Budgeting — BudgetBuddy</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/CSS/style.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold text-primary" href="/index.html">Budget<span style="color:#FACC15">Buddy</span></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu" aria-controls="navMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="/savings.html">Savings</a></li>
           <li class="nav-item btn-primary"><a class="nav-link" href="/index.html">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>
          <div class="col-12">
            <div class="card p-3">
              <h6>Add an Expense</h6>
              <div class="mb-2">
                <label class="form-label">Item</label>
                <input id="expenseName" type="text" class="form-control" placeholder="e.g. Lunch">
              </div>
              <div class="mb-2">
                <label class="form-label">Amount (₦)</label>
                <input id="expenseAmount" type="number" class="form-control" placeholder="e.g. 450">
              </div>
              <div class="d-flex gap-2">
                <button id="addExpenseBtn" class="btn btn-success">Add Expense</button>
                <button id="clearExpenses" class="btn btn-outline-secondary">Clear All</button>
              </div>
              <hr class="my-3">
              <h6 class="mb-2">Recent on this device</h6>
              <ul id="localExpenseList" class="list-group list-group-flush"></ul>
            </div>
          </div>
  </header>

  <main class="container my-4">
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="card p-3">
          <h5 class="mb-3">Create a Budget</h5>
          <div class="mb-2">
            <label class="form-label">Monthly Income (₦)</label>
            <input id="income" type="number" class="form-control" placeholder="e.g. 20000">
          </div>

          <h6 class="mt-3">Planned Categories</h6>
          <div class="mb-2">
            <label class="form-label">Food (₦)</label>
            <input id="catFood" type="number" class="form-control" placeholder="e.g. 5000">
          </div>
          <div class="mb-2">
            <label class="form-label">Transport (₦)</label>
            <input id="catTransport" type="number" class="form-control" placeholder="e.g. 3000">
          </div>
          <div class="mb-2">
            <label class="form-label">Data & Phone (₦)</label>
            <input id="catData" type="number" class="form-control" placeholder="e.g. 2000">
          </div>
          <div class="mb-2">
            <label class="form-label">School / Materials (₦)</label>
            <input id="catSchool" type="number" class="form-control" placeholder="e.g. 4000">
          </div>
          <div class="mb-2">
            <label class="form-label">Other (₦)</label>
            <input id="catOther" type="number" class="form-control" placeholder="e.g. 1000">
          </div>

          <div class="d-grid gap-2 mt-3">
            <button id="genBudget" class="btn btn-primary">Generate Budget</button>
            <button id="saveBudget" class="btn btn-outline-secondary">Save Budget</button>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="row g-3">
          <div class="col-12">
            <div class="card p-3">
              <h6>Summary</h6>
              <p class="mb-1 text-muted">Total Income: <strong id="sumIncome">₦0</strong></p>
              <p class="mb-1 text-muted">Total Planned: <strong id="sumPlanned">₦0</strong></p>
              <p class="mb-1 text-muted">Remaining: <strong id="sumRemaining">₦0</strong></p>
              <div class="progress mt-2">
                <div id="budgetProgress" class="progress-bar" role="progressbar" style="width:0%"></div>
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="card p-3">
              <h6>Suggestions</h6>
              <ul id="suggestions" class="mb-0 text-muted"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-light py-3 mt-4">
    <div class="container text-center small text-muted">© 2026 BudgetBuddy · R.E.G Innovators</div>
  </footer>

  <script>
    // Demo budgeting logic (frontend-only, stores last saved budget in localStorage)
    const $ = id => document.getElementById(id);

    function formatN(n){ return '₦' + Number(n || 0).toLocaleString(); }

    function calcAndRender(){
      const income = Number($('income').value) || 0;
      const food = Number($('catFood').value) || 0;
      const transport = Number($('catTransport').value) || 0;
      const data = Number($('catData').value) || 0;
      const school = Number($('catSchool').value) || 0;
      const other = Number($('catOther').value) || 0;

      const planned = food + transport + data + school + other;
      const remaining = income - planned;

      $('sumIncome').innerText = formatN(income);
      $('sumPlanned').innerText = formatN(planned);
      $('sumRemaining').innerText = formatN(remaining);

      // progress: percent of income planned
      const pct = income > 0 ? Math.min(100, Math.round((planned / income) * 100)) : 0;
      $('budgetProgress').style.width = pct + '%';
      $('budgetProgress').innerText = pct + '%';

      // simple suggestions
      const sug = [];
      if (income === 0) sug.push('Enter your monthly income to get helpful suggestions.');
      if (remaining < 0) sug.push('Planned expenses exceed your income — consider reducing categories.');
      if (remaining >= 0 && remaining < income * 0.1) sug.push('Remaining balance is low — try reducing variable spending.');
      if (remaining >= income * 0.1) sug.push('Nice — you have room to save! Consider creating a savings goal.');

      const sEl = $('suggestions');
      sEl.innerHTML = '';
      sug.forEach(t => { const li=document.createElement('li'); li.innerText = t; sEl.appendChild(li); });
    }

    $('genBudget').addEventListener('click', calcAndRender);

    $('saveBudget').addEventListener('click', () => {
      calcAndRender();
      const payload = {
        income: Number($('income').value) || 0,
        food: Number($('catFood').value) || 0,
        transport: Number($('catTransport').value) || 0,
        data: Number($('catData').value) || 0,
        school: Number($('catSchool').value) || 0,
        other: Number($('catOther').value) || 0,
        savedAt: new Date().toISOString()
      };
      localStorage.setItem('budgetBuddy_budget', JSON.stringify(payload));
      // notify other tabs and listeners
      localStorage.setItem('budgetBuddy_lastUpdate', Date.now());
      window.dispatchEvent(new Event('budgetUpdated'));
      alert('Budget saved locally.');
    });

    // seed from saved
    (function init(){
      const saved = JSON.parse(localStorage.getItem('budgetBuddy_budget') || 'null');
      if(saved){
        $('income').value = saved.income || '';
        $('catFood').value = saved.food || '';
        $('catTransport').value = saved.transport || '';
        $('catData').value = saved.data || '';
        $('catSchool').value = saved.school || '';
        $('catOther').value = saved.other || '';
        calcAndRender();
      }
      // load existing expenses into local list
      function renderLocalExpenses(){
        const listEl = $('localExpenseList');
        const items = JSON.parse(localStorage.getItem('budgetBuddy_expenses')||'[]');
        listEl.innerHTML = '';
        if(items.length===0){ listEl.innerHTML = '<li class="list-group-item text-muted">No expenses yet.</li>'; return; }
        items.slice().reverse().forEach(e=>{
          const li = document.createElement('li'); li.className='list-group-item d-flex justify-content-between';
          const date = new Date(e.date||Date.now()).toLocaleDateString();
          li.innerHTML = `<div><strong>${e.name}</strong><div class="small text-muted">${date}</div></div><div>₦${Number(e.amount||0).toLocaleString()}</div>`;
          listEl.appendChild(li);
        });
      }

      renderLocalExpenses();
    })();

    // expense handling
    document.getElementById('addExpenseBtn').addEventListener('click', function(){
      const name = $('expenseName').value.trim() || 'Expense';
      const amount = Number($('expenseAmount').value) || 0;
      if(amount <= 0){ alert('Enter a valid amount'); return; }
      const items = JSON.parse(localStorage.getItem('budgetBuddy_expenses')||'[]');
      items.push({ name, amount, date: new Date().toISOString() });
      localStorage.setItem('budgetBuddy_expenses', JSON.stringify(items));
      // notify other tabs and dashboard
      localStorage.setItem('budgetBuddy_lastUpdate', Date.now());
      window.dispatchEvent(new Event('budgetUpdated'));
      $('expenseName').value = '';
      $('expenseAmount').value = '';
      alert('Expense added');
      // update local list and dashboard values
      (function refresh(){
        const evt = new Event('budgetUpdated'); window.dispatchEvent(evt);
        const listEl = $('localExpenseList'); listEl.innerHTML='';
        const items2 = JSON.parse(localStorage.getItem('budgetBuddy_expenses')||'[]');
        if(items2.length===0){ listEl.innerHTML = '<li class="list-group-item text-muted">No expenses yet.</li>'; }
        else items2.slice().reverse().forEach(e=>{ const li=document.createElement('li'); li.className='list-group-item d-flex justify-content-between'; li.innerHTML=`<div><strong>${e.name}</strong><div class="small text-muted">${new Date(e.date).toLocaleDateString()}</div></div><div>₦${Number(e.amount).toLocaleString()}</div>`; listEl.appendChild(li); });
      })();
    });

    document.getElementById('clearExpenses').addEventListener('click', function(){
      if(!confirm('Clear all saved expenses on this device?')) return;
      localStorage.removeItem('budgetBuddy_expenses');
      localStorage.setItem('budgetBuddy_lastUpdate', Date.now());
      document.getElementById('localExpenseList').innerHTML = '<li class="list-group-item text-muted">No expenses yet.</li>';
      window.dispatchEvent(new Event('budgetUpdated'));
    });

    // when budget or expenses update, notify dashboard (if open)
    window.addEventListener('budgetUpdated', function(){ /* placeholder for cross-window events */ });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>